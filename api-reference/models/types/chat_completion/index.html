
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Engine for Build Multimodal AI Workflows">
      
      
        <meta name="author" content="Vilson Rodrigues">
      
      
      
        <link rel="prev" href="../../model_gateway/">
      
      
        <link rel="next" href="../../../databases/database/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>ChatCompletion - msgflux</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@8.5.1/dist/mermaid.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#msgflux.models.providers.openai.OpenAIChatCompletion" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="msgflux" class="md-header__button md-logo" aria-label="msgflux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            msgflux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ChatCompletion
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="indigo"  aria-label="Night"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Night" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="indigo"  aria-label="Sunny"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Sunny" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../quickstart/" class="md-tabs__link">
          
  
  
    
  
  Docs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="msgflux" class="md-nav__button md-logo" aria-label="msgflux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    msgflux
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    QuickStart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Learn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Learn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ✧ Models
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            ✧ Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model — Unified Interface for AI Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/model_gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ModelGateway — Resilient Model Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/chat_completion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chat Completion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/moderation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Moderation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/text_embedder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text embedder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/text_to_speech/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text to speech
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/speech_to_text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Speech to text
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/text_to_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../models/image_text_to_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image Edit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ⛁ DataBases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            ⛁ DataBases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/database.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    None
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../databases/vector.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vector
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ⟳ Retrievers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            ⟳ Retrievers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../retrievers/retriever/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retriever
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../parsers/parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ⎙ Parsers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_2_5" id="__nav_2_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ⟢ nn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_5">
            <span class="md-nav__icon md-icon"></span>
            ⟢ nn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../module.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    None
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dependency-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ⇄ Dependency Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4_1" id="__nav_2_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model gateway
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4_1_3" id="__nav_2_4_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Types
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_4_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ChatCompletion
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ChatCompletion
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAIChatCompletion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenAIChatCompletion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.cache_size" class="md-nav__link">
    <span class="md-ellipsis">
      cache_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.context_length" class="md-nav__link">
    <span class="md-ellipsis">
      context_length
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.enable_cache" class="md-nav__link">
    <span class="md-ellipsis">
      enable_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.enable_thinking" class="md-nav__link">
    <span class="md-ellipsis">
      enable_thinking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.model_id" class="md-nav__link">
    <span class="md-ellipsis">
      model_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.parallel_tool_calls" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_tool_calls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.reasoning_in_tool_call" class="md-nav__link">
    <span class="md-ellipsis">
      reasoning_in_tool_call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.reasoning_max_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      reasoning_max_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.return_reasoning" class="md-nav__link">
    <span class="md-ellipsis">
      return_reasoning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.sampling_params" class="md-nav__link">
    <span class="md-ellipsis">
      sampling_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.sampling_run_params" class="md-nav__link">
    <span class="md-ellipsis">
      sampling_run_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.validate_typed_parser_output" class="md-nav__link">
    <span class="md-ellipsis">
      validate_typed_parser_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.verbose" class="md-nav__link">
    <span class="md-ellipsis">
      verbose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.acall" class="md-nav__link">
    <span class="md-ellipsis">
      acall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#msgflux.models.providers.vllm.VLLMChatCompletion" class="md-nav__link">
    <span class="md-ellipsis">
      VLLMChatCompletion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#msgflux.models.providers.openrouter.OpenRouterChatCompletion" class="md-nav__link">
    <span class="md-ellipsis">
      OpenRouterChatCompletion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2" >
        
          
          <label class="md-nav__link" for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DataBases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            DataBases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_4_2_2" id="__nav_2_4_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Types
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/types/kv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KV
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../databases/types/vector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vector
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3" >
        
          
          <label class="md-nav__link" for="__nav_2_4_3" id="__nav_2_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    nn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_3">
            <span class="md-nav__icon md-icon"></span>
            nn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../nn/functional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../nn/modules/agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/category/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/category/multimodal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MultiModal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/category/rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RAG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/category/search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAIChatCompletion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenAIChatCompletion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.cache_size" class="md-nav__link">
    <span class="md-ellipsis">
      cache_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.context_length" class="md-nav__link">
    <span class="md-ellipsis">
      context_length
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.enable_cache" class="md-nav__link">
    <span class="md-ellipsis">
      enable_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.enable_thinking" class="md-nav__link">
    <span class="md-ellipsis">
      enable_thinking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.model_id" class="md-nav__link">
    <span class="md-ellipsis">
      model_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.parallel_tool_calls" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_tool_calls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.reasoning_in_tool_call" class="md-nav__link">
    <span class="md-ellipsis">
      reasoning_in_tool_call
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.reasoning_max_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      reasoning_max_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.return_reasoning" class="md-nav__link">
    <span class="md-ellipsis">
      return_reasoning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.sampling_params" class="md-nav__link">
    <span class="md-ellipsis">
      sampling_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.sampling_run_params" class="md-nav__link">
    <span class="md-ellipsis">
      sampling_run_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.validate_typed_parser_output" class="md-nav__link">
    <span class="md-ellipsis">
      validate_typed_parser_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.verbose" class="md-nav__link">
    <span class="md-ellipsis">
      verbose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msgflux.models.providers.openai.OpenAIChatCompletion.acall" class="md-nav__link">
    <span class="md-ellipsis">
      acall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#msgflux.models.providers.vllm.VLLMChatCompletion" class="md-nav__link">
    <span class="md-ellipsis">
      VLLMChatCompletion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#msgflux.models.providers.openrouter.OpenRouterChatCompletion" class="md-nav__link">
    <span class="md-ellipsis">
      OpenRouterChatCompletion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>ChatCompletion</h1>

<div class="doc doc-object doc-class">



<h2 id="msgflux.models.providers.openai.OpenAIChatCompletion" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">OpenAIChatCompletion</span>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="msgflux.models.providers.openai._BaseOpenAI">_BaseOpenAI</span></code>, <code><span title="msgflux.models.types.ChatCompletionModel">ChatCompletionModel</span></code></p>


        <p>OpenAI Chat Completion.</p>








              <details class="quote">
                <summary>Source code in <code>src/msgflux/models/providers/openai.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="nd">@register_model</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">class</span><span class="w"> </span><span class="nc">OpenAIChatCompletion</span><span class="p">(</span><span class="n">_BaseOpenAI</span><span class="p">,</span> <span class="n">ChatCompletionModel</span><span class="p">):</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;OpenAI Chat Completion.&quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">max_tokens</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">reasoning_effort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">enable_thinking</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">return_reasoning</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">reasoning_in_tool_call</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">validate_typed_parser_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">temperature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">top_p</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">stop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">parallel_tool_calls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">modalities</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">audio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">verbosity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">web_search_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">base_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">context_length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">reasoning_max_tokens</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">enable_cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">cache_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Args:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        model_id:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">            Model ID in provider.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        max_tokens:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">            An upper bound for the number of tokens that can be</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            generated for a completion, including visible output</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            tokens and reasoning tokens.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        reasoning_effort:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            Constrains effort on reasoning for reasoning models.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">            Currently supported values are low, medium, and high.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">            Reducing reasoning effort can result in faster responses</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">            and fewer tokens used on reasoning in a response.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            Can be: &quot;minimal&quot;, &quot;low&quot;, &quot;medium&quot; or &quot;high&quot;.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        enable_thinking:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            If True, enable the model reasoning.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        return_reasoning:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">            If the model returns the `reasoning` field it will be added</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            along with the response.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        reasoning_in_tool_call:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            If True, maintains the reasoning for using the tool call.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        validate_typed_parser_output:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">            If True, use the generation_schema to validate typed parser output.            </span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        temperature:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">            What sampling temperature to use, between 0 and 2.</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">            Higher values like 0.8 will make the output more random,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">            while lower values like 0.2 will make it more focused and</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">            deterministic.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        stop:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">            Up to 4 sequences where the API will stop generating further</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">            tokens. The returned text will not contain the stop sequence.            </span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        top_p:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">            An alternative to sampling with temperature, called nucleus</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">            sampling, where the model considers the results of the tokens</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">            with top_p probability mass. So 0.1 means only the tokens</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">            comprising the top 10% probability mass are considered.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        parallel_tool_calls:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">            If True, enable parallel tool calls.            </span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        modalities:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">            Types of output you would like the model to generate.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">            Can be: [&quot;text&quot;], [&quot;audio&quot;] or [&quot;text&quot;, &quot;audio&quot;].</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        audio:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">            Audio configurations. Define voice and output format.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        verbosity:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">            Constrains the verbosity of the model&#39;s response. Lower </span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            values will result in more concise responses, while higher</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">            values will result in more verbose responses. Currently</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">            supported values are low, medium, and high.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        web_search_options:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">            This tool searches the web for relevant results to use in a response.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">            OpenAI and OpenRouter only.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">        verbose:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">            If True, Prints the model output to the console before it is transformed</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">            into typed structured output.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        base_url:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">            URL to model provider.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        context_length:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">            The maximum context length supported by the model.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        reasoning_max_tokens:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">            Maximum number of tokens for reasoning/thinking.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        enable_cache:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">            If True, enable response caching to avoid redundant API calls.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        cache_size:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">            Maximum number of cached responses (default: 128).</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context_length</span> <span class="o">=</span> <span class="n">context_length</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_max_tokens</span> <span class="o">=</span> <span class="n">reasoning_max_tokens</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_cache</span> <span class="o">=</span> <span class="n">enable_cache</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache_size</span> <span class="o">=</span> <span class="n">cache_size</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;base_url&quot;</span><span class="p">:</span> <span class="n">base_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_url</span><span class="p">()}</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">sampling_run_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_tokens&quot;</span><span class="p">:</span> <span class="n">max_tokens</span><span class="p">}</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">if</span> <span class="n">temperature</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">if</span> <span class="n">top_p</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;top_p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_p</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">if</span> <span class="n">stop</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;verbosity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="k">if</span> <span class="n">modalities</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;modalities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modalities</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="k">if</span> <span class="n">web_search_options</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;web_search_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">web_search_options</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">if</span> <span class="n">audio</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">if</span> <span class="n">reasoning_effort</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;reasoning_effort&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reasoning_effort</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_run_params</span> <span class="o">=</span> <span class="n">sampling_run_params</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_thinking</span> <span class="o">=</span> <span class="n">enable_thinking</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parallel_tool_calls</span> <span class="o">=</span> <span class="n">parallel_tool_calls</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_in_tool_call</span> <span class="o">=</span> <span class="n">reasoning_in_tool_call</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate_typed_parser_output</span> <span class="o">=</span> <span class="n">validate_typed_parser_output</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">return_reasoning</span> <span class="o">=</span> <span class="n">return_reasoning</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_key</span><span class="p">()</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_adapt_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">provider</span> <span class="ow">in</span> <span class="s2">&quot;openai&quot;</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_tokens&quot;</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">return</span> <span class="n">params</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_execute_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">prefilling</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;prefilling&quot;</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">if</span> <span class="n">prefilling</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prefilling</span><span class="p">})</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_run_params</span><span class="p">}</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">adapted_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapt_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">adapted_params</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">return</span> <span class="n">model_output</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_aexecute_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="n">prefilling</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;prefilling&quot;</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">if</span> <span class="n">prefilling</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prefilling</span><span class="p">})</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">sampling_run_params</span><span class="p">}</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">adapted_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adapt_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">model_output</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aclient</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">adapted_params</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="k">return</span> <span class="n">model_output</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_process_model_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_output</span><span class="p">,</span> <span class="n">typed_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">generation_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Shared logic to process model output for both sync and async.&quot;&quot;&quot;</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">ModelResponse</span><span class="p">()</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">()</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="n">model_output</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()})</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">choice</span> <span class="o">=</span> <span class="n">model_output</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">reasoning</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="nb">getattr</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;reasoning_content&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="nb">getattr</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;reasoning&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="nb">getattr</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;thinking&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="n">reasoning_tool_call</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_in_tool_call</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">reasoning_tool_call</span> <span class="o">=</span> <span class="n">reasoning</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">prefix_response_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">reasoning_content</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_reasoning</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="n">reasoning_content</span> <span class="o">=</span> <span class="n">reasoning</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="k">if</span> <span class="n">reasoning_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="n">prefix_response_type</span> <span class="o">=</span> <span class="s2">&quot;reasoning_&quot;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="k">if</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">annotations</span><span class="p">:</span>  <span class="c1"># Extra responses (e.g web search references)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="n">annotations_content</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="n">item</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">annotations</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="p">]</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="n">metadata</span><span class="o">.</span><span class="n">annotations</span> <span class="o">=</span> <span class="n">annotations_content</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="k">if</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">aggregator</span> <span class="o">=</span> <span class="n">ToolCallAggregator</span><span class="p">(</span><span class="n">reasoning_tool_call</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="n">response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;tool_call&quot;</span><span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="k">for</span> <span class="n">call_index</span><span class="p">,</span> <span class="n">tool_call</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">):</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="n">tool_id</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="n">arguments</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                <span class="n">aggregator</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">call_index</span><span class="p">,</span> <span class="n">tool_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">response_content</span> <span class="o">=</span> <span class="n">aggregator</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="k">elif</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">typed_parser</span> <span class="ow">or</span> <span class="n">generation_schema</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                <span class="nb">repr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="si">}</span><span class="s2">][raw_response] </span><span class="si">{</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="n">cprint</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">lc</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="n">response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_response_type</span><span class="si">}</span><span class="s2">structured&quot;</span><span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="n">parser</span> <span class="o">=</span> <span class="n">typed_parser_registry</span><span class="p">[</span><span class="n">typed_parser</span><span class="p">]</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                <span class="n">response_content</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="c1"># Type validation</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="k">if</span> <span class="n">generation_schema</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_typed_parser_output</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                    <span class="n">encoded_response_content</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">response_content</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                    <span class="n">msgspec</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                        <span class="n">encoded_response_content</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">generation_schema</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                    <span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="k">elif</span> <span class="n">generation_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="n">response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_response_type</span><span class="si">}</span><span class="s2">structured&quot;</span><span class="p">)</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">msgspec</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                    <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">generation_schema</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="n">response_content</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">(</span><span class="n">struct_to_dict</span><span class="p">(</span><span class="n">struct</span><span class="p">))</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="n">response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_response_type</span><span class="si">}</span><span class="s2">text_generation&quot;</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="k">if</span> <span class="n">reasoning_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                    <span class="n">response_content</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">({</span><span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">})</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                    <span class="n">response_content</span> <span class="o">=</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="k">elif</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">audio</span><span class="p">:</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="n">response_content</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">(</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                <span class="p">{</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                    <span class="s2">&quot;audio&quot;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                <span class="p">}</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="k">if</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">transcript</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="n">response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;audio_text_generation&quot;</span><span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                <span class="n">response_content</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">choice</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">transcript</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="n">response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;audio_generation&quot;</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="k">if</span> <span class="n">reasoning_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="n">response_content</span><span class="o">.</span><span class="n">think</span> <span class="o">=</span> <span class="n">reasoning_content</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">response</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">response_content</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">response</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="k">return</span> <span class="n">response</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ModelResponse</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="n">typed_parser</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;typed_parser&quot;</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="n">generation_schema</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;generation_schema&quot;</span><span class="p">)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="c1"># Check cache if enabled</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_cache</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_cache</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="n">cache_key</span> <span class="o">=</span> <span class="n">generate_cache_key</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="n">hit</span><span class="p">,</span> <span class="n">cached_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="k">if</span> <span class="n">hit</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>                <span class="k">return</span> <span class="n">cached_response</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="c1"># Pop after cache check to avoid modifying kwargs during cache key generation</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">typed_parser</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;typed_parser&quot;</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">generation_schema</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;generation_schema&quot;</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">if</span> <span class="n">generation_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">typed_parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="n">response_format</span> <span class="o">=</span> <span class="n">response_format_from_msgspec_struct</span><span class="p">(</span><span class="n">generation_schema</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;response_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_format</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_model_output</span><span class="p">(</span><span class="n">model_output</span><span class="p">,</span> <span class="n">typed_parser</span><span class="p">,</span> <span class="n">generation_schema</span><span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="c1"># Store in cache if enabled</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_cache</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_cache</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="c1"># Re-add popped values for cache key</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="n">cache_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;typed_parser&quot;</span><span class="p">:</span> <span class="n">typed_parser</span><span class="p">,</span> <span class="s2">&quot;generation_schema&quot;</span><span class="p">:</span> <span class="n">generation_schema</span><span class="p">}</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">cache_key</span> <span class="o">=</span> <span class="n">generate_cache_key</span><span class="p">(</span><span class="o">**</span><span class="n">cache_kwargs</span><span class="p">)</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_response_cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="k">return</span> <span class="n">response</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_agenerate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ModelResponse</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">typed_parser</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;typed_parser&quot;</span><span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">generation_schema</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;generation_schema&quot;</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="c1"># Check cache if enabled</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_cache</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_cache</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="n">cache_key</span> <span class="o">=</span> <span class="n">generate_cache_key</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">hit</span><span class="p">,</span> <span class="n">cached_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="k">if</span> <span class="n">hit</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                <span class="k">return</span> <span class="n">cached_response</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="c1"># Pop after cache check to avoid modifying kwargs during cache key generation</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="n">typed_parser</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;typed_parser&quot;</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">generation_schema</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;generation_schema&quot;</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="k">if</span> <span class="n">generation_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">typed_parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="n">response_format</span> <span class="o">=</span> <span class="n">response_format_from_msgspec_struct</span><span class="p">(</span><span class="n">generation_schema</span><span class="p">)</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;response_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_format</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="n">model_output</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aexecute_model</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_model_output</span><span class="p">(</span><span class="n">model_output</span><span class="p">,</span> <span class="n">typed_parser</span><span class="p">,</span> <span class="n">generation_schema</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="c1"># Store in cache if enabled</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_cache</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_cache</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="c1"># Re-add popped values for cache key</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="n">cache_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;typed_parser&quot;</span><span class="p">:</span> <span class="n">typed_parser</span><span class="p">,</span> <span class="s2">&quot;generation_schema&quot;</span><span class="p">:</span> <span class="n">generation_schema</span><span class="p">}</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="n">cache_key</span> <span class="o">=</span> <span class="n">generate_cache_key</span><span class="p">(</span><span class="o">**</span><span class="n">cache_kwargs</span><span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_response_cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="k">return</span> <span class="n">response</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_stream_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ModelStreamResponse</span><span class="p">:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="n">aggregator</span> <span class="o">=</span> <span class="n">ToolCallAggregator</span><span class="p">()</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">()</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">stream_response</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stream_response&quot;</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="n">model_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">reasoning_tool_call</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">model_output</span><span class="p">:</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                <span class="n">delta</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">delta</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                <span class="n">reasoning_chunk</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                    <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;reasoning_content&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                    <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;reasoning&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                    <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;thinking&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>                <span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_in_tool_call</span> <span class="ow">and</span> <span class="n">reasoning_chunk</span><span class="p">:</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                    <span class="n">reasoning_tool_call</span> <span class="o">+=</span> <span class="n">reasoning_chunk</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_reasoning</span> <span class="ow">and</span> <span class="n">reasoning_chunk</span><span class="p">:</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                    <span class="k">if</span> <span class="n">stream_response</span><span class="o">.</span><span class="n">response_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;reasoning_text_generation&quot;</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                    <span class="n">stream_response</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">reasoning_chunk</span><span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>                    <span class="k">if</span> <span class="n">stream_response</span><span class="o">.</span><span class="n">response_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;text_generation&quot;</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                    <span class="n">stream_response</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;tool_calls&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                    <span class="k">if</span> <span class="n">stream_response</span><span class="o">.</span><span class="n">response_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;tool_call&quot;</span><span class="p">)</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                    <span class="n">tool_call</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                    <span class="n">call_index</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                    <span class="n">tool_id</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                    <span class="n">arguments</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                    <span class="n">aggregator</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">call_index</span><span class="p">,</span> <span class="n">tool_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;annotations&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">delta</span><span class="o">.</span><span class="n">annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                    <span class="n">metadata</span><span class="o">.</span><span class="n">annotations</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                        <span class="n">item</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">delta</span><span class="o">.</span><span class="n">annotations</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                    <span class="p">]</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="k">if</span> <span class="n">aggregator</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="k">if</span> <span class="n">reasoning_tool_call</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                <span class="n">aggregator</span><span class="o">.</span><span class="n">reasoning</span> <span class="o">=</span> <span class="n">reasoning_tool_call</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">stream_response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">aggregator</span> <span class="c1"># For tool calls save as &#39;data&#39;</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="n">stream_response</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">stream_response</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_astream_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ModelStreamResponse</span><span class="p">:</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">aggregator</span> <span class="o">=</span> <span class="n">ToolCallAggregator</span><span class="p">()</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">dotdict</span><span class="p">()</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">stream_response</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stream_response&quot;</span><span class="p">)</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">model_output</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aexecute_model</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">reasoning_tool_call</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">model_output</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>                <span class="n">delta</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">delta</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                <span class="n">reasoning_chunk</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                    <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;reasoning_content&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>                    <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;reasoning&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                    <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;thinking&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                <span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_in_tool_call</span> <span class="ow">and</span> <span class="n">reasoning_chunk</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                    <span class="n">reasoning_tool_call</span> <span class="o">+=</span> <span class="n">reasoning_chunk</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_reasoning</span> <span class="ow">and</span> <span class="n">reasoning_chunk</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                    <span class="k">if</span> <span class="n">stream_response</span><span class="o">.</span><span class="n">response_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;reasoning_text_generation&quot;</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                    <span class="n">stream_response</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">reasoning_chunk</span><span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                    <span class="k">if</span> <span class="n">stream_response</span><span class="o">.</span><span class="n">response_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;text_generation&quot;</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                    <span class="n">stream_response</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;tool_calls&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                    <span class="k">if</span> <span class="n">stream_response</span><span class="o">.</span><span class="n">response_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                        <span class="n">stream_response</span><span class="o">.</span><span class="n">set_response_type</span><span class="p">(</span><span class="s2">&quot;tool_call&quot;</span><span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                    <span class="n">tool_call</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                    <span class="n">call_index</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                    <span class="n">tool_id</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                    <span class="n">name</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                    <span class="n">arguments</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                    <span class="n">aggregator</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">call_index</span><span class="p">,</span> <span class="n">tool_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot;annotations&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">delta</span><span class="o">.</span><span class="n">annotations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                    <span class="n">metadata</span><span class="o">.</span><span class="n">annotations</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                        <span class="n">item</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">delta</span><span class="o">.</span><span class="n">annotations</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                    <span class="p">]</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="k">elif</span> <span class="n">chunk</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="k">if</span> <span class="n">aggregator</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="k">if</span> <span class="n">reasoning_tool_call</span><span class="p">:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                <span class="n">aggregator</span><span class="o">.</span><span class="n">reasoning</span> <span class="o">=</span> <span class="n">reasoning_tool_call</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="n">stream_response</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">aggregator</span> <span class="c1"># For tool calls save as &#39;data&#39;</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="n">stream_response</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="n">stream_response</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="nd">@model_retry</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="n">messages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="n">prefilling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="n">stream</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="n">generation_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="n">tool_schemas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="n">tool_choice</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="n">typed_parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ModelResponse</span><span class="p">,</span> <span class="n">ModelStreamResponse</span><span class="p">]:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Args:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">            messages:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">                Conversation history. Can be simple string or list of messages.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">            system_prompt:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">                A set of instructions that defines the overarching behavior</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">                and role of the model across all interactions.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">            prefilling:</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">                Forces an initial message from the model. From that message</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">                it will continue its response from there.</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">            stream:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">                Whether generation should be in streaming mode.</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">            generation_schema:</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">                Schema that defines how the output should be structured.</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">            tool_schemas:</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">                JSON schema containing available tools.</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">            tool_choice:</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">                By default the model will determine when and how many tools to use.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">                You can force specific behavior with the tool_choice parameter.</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">                    1. auto:</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">                        (Default) Call zero, one, or multiple functions.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">                    2. required:</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">                        Call one or more functions.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">                    3. Forced Tool:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">                        Call exactly one specific tool e.g: &quot;get_weather&quot;.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">            typed_parser:</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">                Converts the model raw output into a typed-dict. Supported parser:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">                `typed_xml`.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">            ValueError:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">                Raised if `generation_schema` and `stream=True`.</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">            ValueError:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">                Raised if `typed_xml=True` and `stream=True`.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">        &quot;&quot;&quot;</span>        
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>            <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">ChatBlock</span><span class="o">.</span><span class="n">user</span><span class="p">(</span><span class="n">messages</span><span class="p">)]</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>            
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="n">messages</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ChatBlock</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">))</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool_choice</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="k">if</span> <span class="n">tool_choice</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                <span class="n">tool_choice</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>                    <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_choice</span><span class="p">},</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                <span class="p">}</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>        <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="s2">&quot;prefilling&quot;</span><span class="p">:</span> <span class="n">prefilling</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>            <span class="s2">&quot;tool_choice&quot;</span><span class="p">:</span> <span class="n">tool_choice</span><span class="p">,</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="n">tool_schemas</span><span class="p">,</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="p">}</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="k">if</span> <span class="n">tool_schemas</span><span class="p">:</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;parallel_tool_calls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_tool_calls</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`typed_parser` is not `stream=True` compatible&quot;</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="n">stream_response</span> <span class="o">=</span> <span class="n">ModelStreamResponse</span><span class="p">()</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="n">F</span><span class="o">.</span><span class="n">background_task</span><span class="p">(</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_generate</span><span class="p">,</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>                <span class="o">**</span><span class="n">generation_params</span><span class="p">,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="n">stream_response</span><span class="o">=</span><span class="n">stream_response</span><span class="p">,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                <span class="n">stream_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;include_usage&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>            <span class="n">F</span><span class="o">.</span><span class="n">wait_for_event</span><span class="p">(</span><span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="k">return</span> <span class="n">stream_response</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>            <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">and</span> <span class="n">typed_parser</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typed_parser_registry</span><span class="p">:</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                <span class="n">available</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">typed_parser_registry</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="k">raise</span> <span class="n">TypedParserNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                    <span class="sa">f</span><span class="s2">&quot;Typed parser `</span><span class="si">{</span><span class="n">typed_parser</span><span class="si">}</span><span class="s2">` not found. &quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                    <span class="sa">f</span><span class="s2">&quot;Available parsers: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                <span class="p">)</span>            
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                <span class="o">**</span><span class="n">generation_params</span><span class="p">,</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                <span class="n">typed_parser</span><span class="o">=</span><span class="n">typed_parser</span><span class="p">,</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="n">generation_schema</span><span class="o">=</span><span class="n">generation_schema</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="p">)</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="k">return</span> <span class="n">response</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="nd">@model_retry</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">acall</span><span class="p">(</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="n">messages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="n">prefilling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="n">stream</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="n">generation_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="n">tool_schemas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="n">tool_choice</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>        <span class="n">typed_parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ModelResponse</span><span class="p">,</span> <span class="n">ModelStreamResponse</span><span class="p">]:</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Async version of __call__. Args:</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">            messages:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">                Conversation history. Can be simple string or list of messages.</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">            system_prompt:</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">                A set of instructions that defines the overarching behavior</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">                and role of the model across all interactions.</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">            prefilling:</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">                Forces an initial message from the model. From that message</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">                it will continue its response from there.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">            stream:</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">                Whether generation should be in streaming mode.</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">            generation_schema:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">                Schema that defines how the output should be structured.</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">            tool_schemas:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">                JSON schema containing available tools.</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">            tool_choice:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">                By default the model will determine when and how many tools to use.</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">                You can force specific behavior with the tool_choice parameter.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">                    1. auto:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">                        (Default) Call zero, one, or multiple functions.</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">                    2. required:</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">                        Call one or more functions.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">                    3. Forced Tool:</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">                        Call exactly one specific tool e.g: &quot;get_weather&quot;.</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">            typed_parser:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">                Converts the model raw output into a typed-dict. Supported parser:</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">                `typed_xml`.</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">            ValueError:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">                Raised if `generation_schema` and `stream=True`.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">            ValueError:</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">                Raised if `typed_xml=True` and `stream=True`.</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>            <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">ChatBlock</span><span class="o">.</span><span class="n">user</span><span class="p">(</span><span class="n">messages</span><span class="p">)]</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>            <span class="n">messages</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ChatBlock</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">))</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool_choice</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>            <span class="k">if</span> <span class="n">tool_choice</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>                <span class="n">tool_choice</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>                    <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_choice</span><span class="p">},</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>                <span class="p">}</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>        <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>            <span class="s2">&quot;prefilling&quot;</span><span class="p">:</span> <span class="n">prefilling</span><span class="p">,</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>            <span class="s2">&quot;tool_choice&quot;</span><span class="p">:</span> <span class="n">tool_choice</span><span class="p">,</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>            <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="n">tool_schemas</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="p">}</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="k">if</span> <span class="n">tool_schemas</span><span class="p">:</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>            <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;parallel_tool_calls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_tool_calls</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`typed_parser` is not `stream=True` compatible&quot;</span><span class="p">)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="n">stream_response</span> <span class="o">=</span> <span class="n">ModelStreamResponse</span><span class="p">()</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="k">await</span> <span class="n">F</span><span class="o">.</span><span class="n">abackground_task</span><span class="p">(</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_astream_generate</span><span class="p">,</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                <span class="o">**</span><span class="n">generation_params</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                <span class="n">stream_response</span><span class="o">=</span><span class="n">stream_response</span><span class="p">,</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                <span class="n">stream_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;include_usage&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>            <span class="k">await</span> <span class="n">F</span><span class="o">.</span><span class="n">await_for_event</span><span class="p">(</span><span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>            <span class="k">return</span> <span class="n">stream_response</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">and</span> <span class="n">typed_parser</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typed_parser_registry</span><span class="p">:</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                <span class="n">available</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">typed_parser_registry</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                <span class="k">raise</span> <span class="n">TypedParserNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                    <span class="sa">f</span><span class="s2">&quot;Typed parser `</span><span class="si">{</span><span class="n">typed_parser</span><span class="si">}</span><span class="s2">` not found. &quot;</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                    <span class="sa">f</span><span class="s2">&quot;Available parsers: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                <span class="p">)</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agenerate</span><span class="p">(</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                <span class="o">**</span><span class="n">generation_params</span><span class="p">,</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                <span class="n">typed_parser</span><span class="o">=</span><span class="n">typed_parser</span><span class="p">,</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                <span class="n">generation_schema</span><span class="o">=</span><span class="n">generation_schema</span><span class="p">,</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>            <span class="p">)</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.cache_size" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">cache_size</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">cache_size</span> <span class="o">=</span> <span class="n">cache_size</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.context_length" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">context_length</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">context_length</span> <span class="o">=</span> <span class="n">context_length</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.enable_cache" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">enable_cache</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">enable_cache</span> <span class="o">=</span> <span class="n">enable_cache</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.enable_thinking" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">enable_thinking</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">enable_thinking</span> <span class="o">=</span> <span class="n">enable_thinking</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.model_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">model_id</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.parallel_tool_calls" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">parallel_tool_calls</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">parallel_tool_calls</span> <span class="o">=</span> <span class="n">parallel_tool_calls</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.reasoning_in_tool_call" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">reasoning_in_tool_call</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">reasoning_in_tool_call</span> <span class="o">=</span> <span class="n">reasoning_in_tool_call</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.reasoning_max_tokens" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">reasoning_max_tokens</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">reasoning_max_tokens</span> <span class="o">=</span> <span class="n">reasoning_max_tokens</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.return_reasoning" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">return_reasoning</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">return_reasoning</span> <span class="o">=</span> <span class="n">return_reasoning</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.sampling_params" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">sampling_params</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">sampling_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;base_url&#39;</span><span class="p">:</span> <span class="n">base_url</span> <span class="ow">or</span> <span class="n">_get_base_url</span><span class="p">()}</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.sampling_run_params" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">sampling_run_params</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">sampling_run_params</span> <span class="o">=</span> <span class="n">sampling_run_params</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.validate_typed_parser_output" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">validate_typed_parser_output</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">validate_typed_parser_output</span> <span class="o">=</span> <span class="n">validate_typed_parser_output</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.verbose" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">verbose</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.__call__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__call__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__call__</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">messages</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">system_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">prefilling</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">generation_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">tool_schemas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">tool_choice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">typed_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>messages</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Conversation history. Can be simple string or list of messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>system_prompt</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A set of instructions that defines the overarching behavior
and role of the model across all interactions.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prefilling</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forces an initial message from the model. From that message
it will continue its response from there.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stream</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether generation should be in streaming mode.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>generation_schema</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="msgspec.Struct">Struct</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Schema that defines how the output should be structured.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tool_schemas</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>JSON schema containing available tools.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tool_choice</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>By default the model will determine when and how many tools to use.
You can force specific behavior with the tool_choice parameter.
    1. auto:
        (Default) Call zero, one, or multiple functions.
    2. required:
        Call one or more functions.
    3. Forced Tool:
        Call exactly one specific tool e.g: "get_weather".</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>typed_parser</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Converts the model raw output into a typed-dict. Supported parser:
<code>typed_xml</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raised if <code>generation_schema</code> and <code>stream=True</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raised if <code>typed_xml=True</code> and <code>stream=True</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/msgflux/models/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="nd">@model_retry</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="n">messages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="n">prefilling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="n">stream</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="n">generation_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="n">tool_schemas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="n">tool_choice</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>    <span class="n">typed_parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ModelResponse</span><span class="p">,</span> <span class="n">ModelStreamResponse</span><span class="p">]:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Args:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">        messages:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">            Conversation history. Can be simple string or list of messages.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">        system_prompt:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">            A set of instructions that defines the overarching behavior</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">            and role of the model across all interactions.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">        prefilling:</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">            Forces an initial message from the model. From that message</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">            it will continue its response from there.</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">        stream:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">            Whether generation should be in streaming mode.</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        generation_schema:</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">            Schema that defines how the output should be structured.</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        tool_schemas:</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">            JSON schema containing available tools.</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        tool_choice:</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">            By default the model will determine when and how many tools to use.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">            You can force specific behavior with the tool_choice parameter.</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">                1. auto:</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">                    (Default) Call zero, one, or multiple functions.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">                2. required:</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">                    Call one or more functions.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">                3. Forced Tool:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">                    Call exactly one specific tool e.g: &quot;get_weather&quot;.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">        typed_parser:</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">            Converts the model raw output into a typed-dict. Supported parser:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">            `typed_xml`.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        ValueError:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">            Raised if `generation_schema` and `stream=True`.</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">        ValueError:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">            Raised if `typed_xml=True` and `stream=True`.</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    &quot;&quot;&quot;</span>        
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">ChatBlock</span><span class="o">.</span><span class="n">user</span><span class="p">(</span><span class="n">messages</span><span class="p">)]</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>            
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="n">messages</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ChatBlock</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">))</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool_choice</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="k">if</span> <span class="n">tool_choice</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>            <span class="n">tool_choice</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_choice</span><span class="p">},</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="p">}</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>    <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="s2">&quot;prefilling&quot;</span><span class="p">:</span> <span class="n">prefilling</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>        <span class="s2">&quot;tool_choice&quot;</span><span class="p">:</span> <span class="n">tool_choice</span><span class="p">,</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="n">tool_schemas</span><span class="p">,</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="p">}</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="k">if</span> <span class="n">tool_schemas</span><span class="p">:</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;parallel_tool_calls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_tool_calls</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`typed_parser` is not `stream=True` compatible&quot;</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="n">stream_response</span> <span class="o">=</span> <span class="n">ModelStreamResponse</span><span class="p">()</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="n">F</span><span class="o">.</span><span class="n">background_task</span><span class="p">(</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_generate</span><span class="p">,</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="o">**</span><span class="n">generation_params</span><span class="p">,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="n">stream_response</span><span class="o">=</span><span class="n">stream_response</span><span class="p">,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="n">stream_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;include_usage&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>        <span class="n">F</span><span class="o">.</span><span class="n">wait_for_event</span><span class="p">(</span><span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>        <span class="k">return</span> <span class="n">stream_response</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">and</span> <span class="n">typed_parser</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typed_parser_registry</span><span class="p">:</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>            <span class="n">available</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">typed_parser_registry</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="k">raise</span> <span class="n">TypedParserNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                <span class="sa">f</span><span class="s2">&quot;Typed parser `</span><span class="si">{</span><span class="n">typed_parser</span><span class="si">}</span><span class="s2">` not found. &quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                <span class="sa">f</span><span class="s2">&quot;Available parsers: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="p">)</span>            
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="o">**</span><span class="n">generation_params</span><span class="p">,</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="n">typed_parser</span><span class="o">=</span><span class="n">typed_parser</span><span class="p">,</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>            <span class="n">generation_schema</span><span class="o">=</span><span class="n">generation_schema</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="p">)</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__init__</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">model_id</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">max_tokens</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">reasoning_effort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">enable_thinking</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">return_reasoning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">reasoning_in_tool_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">validate_typed_parser_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">top_p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">modalities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">audio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">verbosity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">web_search_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">base_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">context_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">reasoning_max_tokens</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">enable_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="n">cache_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>model_id:
    Model ID in provider.
max_tokens:
    An upper bound for the number of tokens that can be
    generated for a completion, including visible output
    tokens and reasoning tokens.
reasoning_effort:
    Constrains effort on reasoning for reasoning models.
    Currently supported values are low, medium, and high.
    Reducing reasoning effort can result in faster responses
    and fewer tokens used on reasoning in a response.
    Can be: "minimal", "low", "medium" or "high".
enable_thinking:
    If True, enable the model reasoning.
return_reasoning:
    If the model returns the <code>reasoning</code> field it will be added
    along with the response.
reasoning_in_tool_call:
    If True, maintains the reasoning for using the tool call.
validate_typed_parser_output:
    If True, use the generation_schema to validate typed parser output.          <br />
temperature:
    What sampling temperature to use, between 0 and 2.
    Higher values like 0.8 will make the output more random,
    while lower values like 0.2 will make it more focused and
    deterministic.
stop:
    Up to 4 sequences where the API will stop generating further
    tokens. The returned text will not contain the stop sequence.          <br />
top_p:
    An alternative to sampling with temperature, called nucleus
    sampling, where the model considers the results of the tokens
    with top_p probability mass. So 0.1 means only the tokens
    comprising the top 10% probability mass are considered.
parallel_tool_calls:
    If True, enable parallel tool calls.          <br />
modalities:
    Types of output you would like the model to generate.
    Can be: ["text"], ["audio"] or ["text", "audio"].
audio:
    Audio configurations. Define voice and output format.
verbosity:
    Constrains the verbosity of the model's response. Lower 
    values will result in more concise responses, while higher
    values will result in more verbose responses. Currently
    supported values are low, medium, and high.
web_search_options:
    This tool searches the web for relevant results to use in a response.
    OpenAI and OpenRouter only.
verbose:
    If True, Prints the model output to the console before it is transformed
    into typed structured output.
base_url:
    URL to model provider.
context_length:
    The maximum context length supported by the model.
reasoning_max_tokens:
    Maximum number of tokens for reasoning/thinking.
enable_cache:
    If True, enable response caching to avoid redundant API calls.
cache_size:
    Maximum number of cached responses (default: 128).</p>


            <details class="quote">
              <summary>Source code in <code>src/msgflux/models/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">max_tokens</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">reasoning_effort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="n">enable_thinking</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">return_reasoning</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">reasoning_in_tool_call</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">validate_typed_parser_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">temperature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">top_p</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">stop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">parallel_tool_calls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">modalities</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">audio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">verbosity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="n">web_search_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">base_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="n">context_length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">reasoning_max_tokens</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">enable_cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">cache_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Args:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    model_id:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        Model ID in provider.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    max_tokens:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        An upper bound for the number of tokens that can be</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        generated for a completion, including visible output</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        tokens and reasoning tokens.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    reasoning_effort:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        Constrains effort on reasoning for reasoning models.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        Currently supported values are low, medium, and high.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Reducing reasoning effort can result in faster responses</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        and fewer tokens used on reasoning in a response.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        Can be: &quot;minimal&quot;, &quot;low&quot;, &quot;medium&quot; or &quot;high&quot;.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    enable_thinking:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        If True, enable the model reasoning.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    return_reasoning:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        If the model returns the `reasoning` field it will be added</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        along with the response.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    reasoning_in_tool_call:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        If True, maintains the reasoning for using the tool call.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    validate_typed_parser_output:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        If True, use the generation_schema to validate typed parser output.            </span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    temperature:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        What sampling temperature to use, between 0 and 2.</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        Higher values like 0.8 will make the output more random,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        while lower values like 0.2 will make it more focused and</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        deterministic.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    stop:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        Up to 4 sequences where the API will stop generating further</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        tokens. The returned text will not contain the stop sequence.            </span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    top_p:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        An alternative to sampling with temperature, called nucleus</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        sampling, where the model considers the results of the tokens</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        with top_p probability mass. So 0.1 means only the tokens</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        comprising the top 10% probability mass are considered.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    parallel_tool_calls:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        If True, enable parallel tool calls.            </span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    modalities:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        Types of output you would like the model to generate.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        Can be: [&quot;text&quot;], [&quot;audio&quot;] or [&quot;text&quot;, &quot;audio&quot;].</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    audio:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        Audio configurations. Define voice and output format.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    verbosity:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        Constrains the verbosity of the model&#39;s response. Lower </span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        values will result in more concise responses, while higher</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        values will result in more verbose responses. Currently</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        supported values are low, medium, and high.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    web_search_options:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        This tool searches the web for relevant results to use in a response.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        OpenAI and OpenRouter only.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    verbose:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        If True, Prints the model output to the console before it is transformed</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        into typed structured output.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    base_url:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        URL to model provider.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    context_length:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        The maximum context length supported by the model.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    reasoning_max_tokens:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Maximum number of tokens for reasoning/thinking.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    enable_cache:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        If True, enable response caching to avoid redundant API calls.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    cache_size:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        Maximum number of cached responses (default: 128).</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">context_length</span> <span class="o">=</span> <span class="n">context_length</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_max_tokens</span> <span class="o">=</span> <span class="n">reasoning_max_tokens</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">enable_cache</span> <span class="o">=</span> <span class="n">enable_cache</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cache_size</span> <span class="o">=</span> <span class="n">cache_size</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sampling_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;base_url&quot;</span><span class="p">:</span> <span class="n">base_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_url</span><span class="p">()}</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">sampling_run_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_tokens&quot;</span><span class="p">:</span> <span class="n">max_tokens</span><span class="p">}</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">if</span> <span class="n">temperature</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">if</span> <span class="n">top_p</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;top_p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_p</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">if</span> <span class="n">stop</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;verbosity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">if</span> <span class="n">modalities</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;modalities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modalities</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">if</span> <span class="n">web_search_options</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;web_search_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">web_search_options</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">if</span> <span class="n">audio</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">if</span> <span class="n">reasoning_effort</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">sampling_run_params</span><span class="p">[</span><span class="s2">&quot;reasoning_effort&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reasoning_effort</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sampling_run_params</span> <span class="o">=</span> <span class="n">sampling_run_params</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">enable_thinking</span> <span class="o">=</span> <span class="n">enable_thinking</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">parallel_tool_calls</span> <span class="o">=</span> <span class="n">parallel_tool_calls</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_in_tool_call</span> <span class="o">=</span> <span class="n">reasoning_in_tool_call</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">validate_typed_parser_output</span> <span class="o">=</span> <span class="n">validate_typed_parser_output</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">return_reasoning</span> <span class="o">=</span> <span class="n">return_reasoning</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_key</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="msgflux.models.providers.openai.OpenAIChatCompletion.acall" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">acall</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">acall</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">messages</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">system_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">prefilling</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">generation_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">tool_schemas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">tool_choice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">typed_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Async version of <strong>call</strong>. Args:
    messages:
        Conversation history. Can be simple string or list of messages.
    system_prompt:
        A set of instructions that defines the overarching behavior
        and role of the model across all interactions.
    prefilling:
        Forces an initial message from the model. From that message
        it will continue its response from there.
    stream:
        Whether generation should be in streaming mode.
    generation_schema:
        Schema that defines how the output should be structured.
    tool_schemas:
        JSON schema containing available tools.
    tool_choice:
        By default the model will determine when and how many tools to use.
        You can force specific behavior with the tool_choice parameter.
            1. auto:
                (Default) Call zero, one, or multiple functions.
            2. required:
                Call one or more functions.
            3. Forced Tool:
                Call exactly one specific tool e.g: "get_weather".
    typed_parser:
        Converts the model raw output into a typed-dict. Supported parser:
        <code>typed_xml</code>.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raised if <code>generation_schema</code> and <code>stream=True</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raised if <code>typed_xml=True</code> and <code>stream=True</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/msgflux/models/providers/openai.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="nd">@model_retry</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">acall</span><span class="p">(</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="n">messages</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>    <span class="n">system_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="n">prefilling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>    <span class="n">stream</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>    <span class="n">generation_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">msgspec</span><span class="o">.</span><span class="n">Struct</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>    <span class="n">tool_schemas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>    <span class="n">tool_choice</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>    <span class="n">typed_parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ModelResponse</span><span class="p">,</span> <span class="n">ModelStreamResponse</span><span class="p">]:</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Async version of __call__. Args:</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">        messages:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">            Conversation history. Can be simple string or list of messages.</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        system_prompt:</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">            A set of instructions that defines the overarching behavior</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">            and role of the model across all interactions.</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        prefilling:</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">            Forces an initial message from the model. From that message</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">            it will continue its response from there.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">        stream:</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">            Whether generation should be in streaming mode.</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">        generation_schema:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">            Schema that defines how the output should be structured.</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">        tool_schemas:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">            JSON schema containing available tools.</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">        tool_choice:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">            By default the model will determine when and how many tools to use.</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">            You can force specific behavior with the tool_choice parameter.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">                1. auto:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">                    (Default) Call zero, one, or multiple functions.</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">                2. required:</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">                    Call one or more functions.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">                3. Forced Tool:</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">                    Call exactly one specific tool e.g: &quot;get_weather&quot;.</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">        typed_parser:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">            Converts the model raw output into a typed-dict. Supported parser:</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">            `typed_xml`.</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">        ValueError:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">            Raised if `generation_schema` and `stream=True`.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">        ValueError:</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">            Raised if `typed_xml=True` and `stream=True`.</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">ChatBlock</span><span class="o">.</span><span class="n">user</span><span class="p">(</span><span class="n">messages</span><span class="p">)]</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="n">messages</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ChatBlock</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">system_prompt</span><span class="p">))</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool_choice</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="k">if</span> <span class="n">tool_choice</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>            <span class="n">tool_choice</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_choice</span><span class="p">},</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>            <span class="p">}</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>    <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>        <span class="s2">&quot;prefilling&quot;</span><span class="p">:</span> <span class="n">prefilling</span><span class="p">,</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>        <span class="s2">&quot;tool_choice&quot;</span><span class="p">:</span> <span class="n">tool_choice</span><span class="p">,</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="n">tool_schemas</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>    <span class="p">}</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>    <span class="k">if</span> <span class="n">tool_schemas</span><span class="p">:</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;parallel_tool_calls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_tool_calls</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`typed_parser` is not `stream=True` compatible&quot;</span><span class="p">)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="n">stream_response</span> <span class="o">=</span> <span class="n">ModelStreamResponse</span><span class="p">()</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="k">await</span> <span class="n">F</span><span class="o">.</span><span class="n">abackground_task</span><span class="p">(</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_astream_generate</span><span class="p">,</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="o">**</span><span class="n">generation_params</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="n">stream_response</span><span class="o">=</span><span class="n">stream_response</span><span class="p">,</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="n">stream_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;include_usage&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="k">await</span> <span class="n">F</span><span class="o">.</span><span class="n">await_for_event</span><span class="p">(</span><span class="n">stream_response</span><span class="o">.</span><span class="n">first_chunk_event</span><span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="k">return</span> <span class="n">stream_response</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="k">if</span> <span class="n">typed_parser</span> <span class="ow">and</span> <span class="n">typed_parser</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typed_parser_registry</span><span class="p">:</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="n">available</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">typed_parser_registry</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>            <span class="k">raise</span> <span class="n">TypedParserNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                <span class="sa">f</span><span class="s2">&quot;Typed parser `</span><span class="si">{</span><span class="n">typed_parser</span><span class="si">}</span><span class="s2">` not found. &quot;</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                <span class="sa">f</span><span class="s2">&quot;Available parsers: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>            <span class="p">)</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agenerate</span><span class="p">(</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>            <span class="o">**</span><span class="n">generation_params</span><span class="p">,</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>            <span class="n">typed_parser</span><span class="o">=</span><span class="n">typed_parser</span><span class="p">,</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>            <span class="n">generation_schema</span><span class="o">=</span><span class="n">generation_schema</span><span class="p">,</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="p">)</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="msgflux.models.providers.vllm.VLLMChatCompletion" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">VLLMChatCompletion</span>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="msgflux.models.providers.vllm._BaseVLLM">_BaseVLLM</span></code>, <code><a class="autorefs autorefs-internal" title="OpenAIChatCompletion (msgflux.models.providers.openai.OpenAIChatCompletion)" href="#msgflux.models.providers.openai.OpenAIChatCompletion">OpenAIChatCompletion</a></code></p>


        <p>vLLM Chat Completion.</p>








              <details class="quote">
                <summary>Source code in <code>src/msgflux/models/providers/vllm.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="nd">@register_model</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">class</span><span class="w"> </span><span class="nc">VLLMChatCompletion</span><span class="p">(</span><span class="n">_BaseVLLM</span><span class="p">,</span> <span class="n">OpenAIChatCompletion</span><span class="p">):</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;vLLM Chat Completion.&quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_adapt_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="n">response_format</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;response_format&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="n">extra_body</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extra_body&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="k">if</span> <span class="n">response_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="n">extra_body</span><span class="p">[</span><span class="s2">&quot;guided_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_format</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_thinking</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="n">extra_body</span><span class="p">[</span><span class="s2">&quot;chat_template_kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>                <span class="s2">&quot;enable_thinking&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_thinking</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="p">}</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;extra_body&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extra_body</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">return</span> <span class="n">params</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="msgflux.models.providers.openrouter.OpenRouterChatCompletion" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">OpenRouterChatCompletion</span>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="msgflux.models.providers.openrouter._BaseOpenRouter">_BaseOpenRouter</span></code>, <code><a class="autorefs autorefs-internal" title="OpenAIChatCompletion (msgflux.models.providers.openai.OpenAIChatCompletion)" href="#msgflux.models.providers.openai.OpenAIChatCompletion">OpenAIChatCompletion</a></code></p>


        <p>OpenRouter Chat Completion.</p>








              <details class="quote">
                <summary>Source code in <code>src/msgflux/models/providers/openrouter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="nd">@register_model</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">class</span><span class="w"> </span><span class="nc">OpenRouterChatCompletion</span><span class="p">(</span><span class="n">_BaseOpenRouter</span><span class="p">,</span> <span class="n">OpenAIChatCompletion</span><span class="p">):</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;OpenRouter Chat Completion.&quot;&quot;&quot;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_adapt_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="n">extra_body</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extra_body&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tool_choice&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tool_choice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tool_choice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="n">reasoning_effort</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;reasoning_effort&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>      
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">if</span> <span class="n">reasoning_effort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="n">extra_body</span><span class="p">[</span><span class="s2">&quot;reasoning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;effort&quot;</span><span class="p">:</span> <span class="n">reasoning_effort</span><span class="p">}</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="c1"># For non-OpenAI models enable web-search plugin</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">web_search_options</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;web_search_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="k">if</span> <span class="n">web_search_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;openai&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;web_search_options&quot;</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="n">web_pluging</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">}</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">web_pluging</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">web_search_options</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="n">plugins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web_pluging</span><span class="p">)</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="k">if</span> <span class="n">plugins</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="n">extra_body</span><span class="p">[</span><span class="s2">&quot;plugins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugins</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;extra_body&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extra_body</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;extra_headers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="s2">&quot;HTTP-Referer&quot;</span><span class="p">:</span> <span class="s2">&quot;msgflux.com&quot;</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="s2">&quot;X-Title&quot;</span><span class="p">:</span> <span class="s2">&quot;msgflux&quot;</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="p">}</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">return</span> <span class="n">params</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Vilson Rodrigues
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.top", "header.autohide", "blog", "content.code.copy", "navigation.tracking"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
    
  </body>
</html>